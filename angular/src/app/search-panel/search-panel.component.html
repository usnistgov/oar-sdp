<p-toast [baseZIndex]="5000">
  <ng-template let-message pTemplate="message">
    <div style="display: flex; align-items: center; margin: 5px">
      <i class="pi pi-info-circle" style="font-size: 30px; padding: 0 10px"></i>
      <div>{{ message.detail }}</div>
    </div>
  </ng-template>
</p-toast>

<div>
  <div class="content-wrapper p-d-flex p-jc-center" style="margin-top: 1em">
    <div>
      <h3 *ngIf="title" class="heading title has-text-black">{{ title }}</h3>

      <a *ngIf="helpicon" [routerLink]="['/help']" target="_blank">
        <i
          class="pi pi-question-circle help-icon"
          data-toggle="tooltip"
          title="How to build Advanced Search Queries"
        ></i>
      </a>

      <p *ngIf="subtitle" class="TexAlCenter subTitle">
        <i>
          Explore data, tools, and resources for Science, Engineering,
          Technology and
          <a href="" [routerLink]="['/about']"><u>more.</u></a>
        </i>
      </p>

      <!-- Search Input with inline mode toggle -->
      <div class="search-container" style="margin: auto; width: 80%">
        <!-- Search Mode Toggle (inline with search bar) -->
        <div *ngIf="showSearchModes" class="search-mode-inline">
          <p-selectButton
            [options]="searchModes"
            [(ngModel)]="selectedSearchMode"
            (onChange)="onSearchModeChange($event.value)"
            optionLabel="label"
            styleClass="compact-select-button"
          >
            <ng-template let-item let-i="index" pTemplate>
              <i class="pi" [ngClass]="item.icon" style="margin-right: 5px;"></i>
              <span>{{ item.label }}</span>
            </ng-template></p-selectButton
          >
        </div>

        <!-- Search Input Group -->
        <div class="p-inputgroup search-input-container">
          <p-autoComplete
            pInputText
            p-fluid
            #audocomp
            [autoOptionFocus]="false"
            [inputStyle]="{
              width: '100%',
              'padding-left': '2rem',
              color: 'white',
              'border-color': 'white'
            }"
            (onFocus)="clearText()"
            (onBlur)="addPlaceholder()"
            [placeholder]="placeholder"
            [(ngModel)]="searchValue"
            inputId="searchinput"
            name="searchinput"
            (keyup.enter)="
              audocomp.handleDropdownClick();
              search(searchValue, searchTaxonomyKey)
            "
            (ngModelChange)="onSearchValueChange()"
            [suggestions]="suggestedTaxonomyList"
            (completeMethod)="filterTaxonomies($event)"
            [minLength]="1"
            [maxlength]="2048"
            [style]="{ width: '100%', color: 'white' }"
          >
            <ng-template let-taxonomy pTemplate="item">
              <div
                class="autoComplete autocompleteItem"
                style="color: white; text-align: left; margin-left: 40px"
              >
                {{ taxonomy }}
              </div>
            </ng-template>
          </p-autoComplete>
          
          <span
            class="p-inputgroup-addon"
            (click)="hideAllHelp(); search(searchValue, searchTaxonomyKey)"
            style="cursor: pointer; color: white; border-color: white; margin-left: 10px; border-top-left-radius: 5px; border-bottom-left-radius: 5px; height: auto;"
          >
            <i class="pi pi-search"></i>
          </span>
          <span
            class="p-inputgroup-addon"
            style="cursor: pointer; color: white; border-color: white; height: auto;"
            (click)="clearSearchBox()"
          >
            <i class="pi pi-times"></i>
          </span>
          
        </div>

        <!-- AI Badge (inline to the right) -->
        <div *ngIf="aiSearchEnabled && showSearchModes" class="ai-badge-inline">
          <i class="pi pi-bolt"></i> AI-powered
        </div>
      </div>

      <!-- Error Messages -->
      <div
        style="width: 100%; text-align: left; color: rgb(255, 162, 162)"
        *ngIf="queryStringError"
        [innerHTML]="queryStringErrorMessage"
      ></div>

      <!-- Examples Toggle - Moved below search, smaller and less prominent -->
      <div
        class="examples-toggle-section"
        style="margin-top: 0.75rem; text-align: center; margin-bottom: 0.75rem;"
      >
        <button
          *ngIf="!showExampleStatus"
          class="examples-toggle-btn-small"
          (click)="searchQueryService.setShowExamples(true)"
        >
          <i class="pi pi-lightbulb"></i> Show Search Examples
        </button>
        <button
          *ngIf="showExampleStatus"
          class="examples-toggle-btn-small active"
          (click)="searchQueryService.setShowExamples(false)"
        >
          <i class="pi pi-times"></i> Hide Examples
        </button>
      </div>
    </div>
  </div>

  <!-- Examples Section - Improved Design -->
  <div
    class="examples-wrapper"
    [@changeDivSize]="currentState"
    *ngIf="showExampleStatus"
  >
    <div class="examples-container">
      <div class="examples-header">
        <h4><i class="pi pi-book"></i> Search Syntax Guide</h4>
        <button
          class="close-examples-btn"
          (click)="searchQueryService.setShowExamples(false)"
        >
          <i class="pi pi-times"></i>
        </button>
      </div>

      <div class="examples-grid">
        <div *ngFor="let rule of syntaxRules" class="example-card">
          <div class="example-header">
            <strong>{{ rule.criteria }}</strong>
          </div>
          <div class="example-content">
            <div class="example-code">
              <code (click)="setSearchValue(rule.example)">{{
                rule.example
              }}</code>
              <button
                class="copy-btn"
                (click)="setSearchValue(rule.example)"
                title="Use this example"
              >
                <i class="pi pi-copy"></i>
              </button>
            </div>
            <div class="example-description">
              {{ rule.description }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Keep existing overlay panels -->
  <p-overlayPanel #op1 [dismissable]="true" [showCloseIcon]="false">
    <div class="p-grid">
      <div
        class="p-col"
        *ngFor="let field of fields"
        (click)="appendToSearchBox(field.value, '=', op1)"
      >
        <div>{{ field.label }} - {{ field.value }}</div>
      </div>
    </div>
  </p-overlayPanel>

  <p-overlayPanel #op2 [dismissable]="false" [showCloseIcon]="true">
    <div class="p-grid">
      <div class="p-col-6">
        <button
          pButton
          type="button"
          label="AND"
          (click)="appendToSearchBox(' AND ', null, op2)"
        ></button>
      </div>
      <div class="p-col-6">
        <button
          pButton
          type="button"
          label="OR"
          (click)="appendToSearchBox(' OR ', null, op2)"
        ></button>
      </div>
    </div>
    <div class="p-grid">
      <div
        class="p-col"
        *ngFor="let field of fields"
        (click)="addKeyValuePairToSearchBox($event, field.value, op2, op4)"
      >
        <div>{{ field.value }}</div>
        <div>{{ field.label }}</div>
      </div>
    </div>
  </p-overlayPanel>

  <p-overlayPanel #op4 [dismissable]="false" [showCloseIcon]="true">
    <div class="p-grid">
      <div class="p-col-12">
        <span class="inner-addon">
          <input
            pInputText
            type="text"
            class="overlay-input"
            #field
            placeholder="Please enter a value here"
            (keyup.enter)="processInputValue($event.target.value, op4)"
            style="background-color: rgb(252, 246, 237)"
          />
          <i
            class="pi pi-times clear-box2"
            (click)="field.value = ''"
            data-toggle="tooltip"
            title="Clear the search box"
          ></i>
        </span>
        <button
          pButton
          type="button"
          label="Set"
          (click)="processInputValue(field.value, op4)"
        ></button>
        <div style="font-style: italic; font-size: 12px; padding-top: 0.2em">
          Example:
          <span class="link-text" (click)="field.value = getExample()">{{
            getExample()
          }}</span>
        </div>
        <div *ngIf="inputValueMissing" style="color: red">
          A value is required.
        </div>
      </div>
    </div>
  </p-overlayPanel>

  <p-overlayPanel #op5 [dismissable]="true" [showCloseIcon]="false">
    <div class="p-grid">
      <div class="p-col-12">
        <span class="inner-addon">
          <input
            pInputText
            type="text"
            class="overlay-input"
            #field2
            placeholder="Please enter unique query name"
            (keyup.enter)="saveAdvQuery($event.target.value, op5)"
            style="background-color: rgb(252, 246, 237)"
          />
          <i
            class="pi pi-times clear-box2"
            (click)="field2.value = ''"
            data-toggle="tooltip"
            title="Clear the search box"
          ></i>
        </span>
        <button
          pButton
          type="button"
          label="Save Query"
          (click)="saveAdvQuery(field2.value, op5)"
        ></button>
      </div>
    </div>
  </p-overlayPanel>
</div>
